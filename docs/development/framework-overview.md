# å®šæ—¶ä»»åŠ¡æ¡†æ¶æ¦‚è¿°

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

### âœ… æ¡†æ¶æ¶æ„è®¾è®¡

æˆ‘ä»¬æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŸºäº SST çš„å¯é…ç½®å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å¯é…ç½®æ€§**: é€šè¿‡ `config/scheduled-tasks.json` é›†ä¸­ç®¡ç†æ‰€æœ‰ä»»åŠ¡
2. **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒ Python å’Œ Node.js ä¸¤ç§è¿è¡Œæ—¶
3. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’Œæ¨¡å—åŒ–è®¾è®¡
4. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„ä»»åŠ¡ç±»å‹å’Œå‡½æ•°

### âœ… æ ¸å¿ƒç»„ä»¶

#### 1. é…ç½®æ–‡ä»¶ (`config/scheduled-tasks.json`)

```json
{
  "tasks": [
    {
      "name": "python-task-1",
      "description": "Python simple task 1 - log timestamp",
      "function": "python_crawler",
      "runtime": "python3.11",
      "schedule": "rate(5 minutes)",
      "enabled": true,
      "config": {
        "taskName": "python_simple_task_1",
        "taskType": "simple_task_1",
        "timeout": 300,
        "memory": 512
      }
    }
  ]
}
```

#### 2. Lambda å‡½æ•°

- **`functions/python_crawler.py`**: Python ä»»åŠ¡æ‰§è¡Œæ¡†æ¶
- **`functions/nodejs_crawler.js`**: Node.js ä»»åŠ¡æ‰§è¡Œæ¡†æ¶

#### 3. ç®¡ç†å·¥å…· (`tools/task-manager.js`)

- æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨: `node tools/task-manager.js list`
- éªŒè¯é…ç½®: `node tools/task-manager.js validate`
- å¯ç”¨/ç¦ç”¨ä»»åŠ¡: `node tools/task-manager.js enable/disable <task-name>`

#### 4. SST é…ç½® (`sst.config.ts`)

- ä»é…ç½®æ–‡ä»¶åŠ¨æ€è¯»å–ä»»åŠ¡å®šä¹‰
- è‡ªåŠ¨åˆ›å»º Lambda å‡½æ•°å’Œ EventBridge è§„åˆ™
- æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²

### âœ… ç®€å•ä»»åŠ¡éªŒè¯

åˆ›å»ºäº†ä¸¤ä¸ªç®€å•çš„ä»»åŠ¡ç±»å‹æ¥éªŒè¯æ¡†æ¶ï¼š

1. **simple_task_1**: è®°å½•å½“å‰æ—¶é—´æˆ³
2. **simple_task_2**: å›æ˜¾äº‹ä»¶æ•°æ®

### âœ… æµ‹è¯•éªŒè¯

æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼š

- âœ… Simple Task 1: æ—¶é—´æˆ³è®°å½•åŠŸèƒ½æ­£å¸¸
- âœ… Simple Task 2: äº‹ä»¶æ•°æ®å¤„ç†åŠŸèƒ½æ­£å¸¸
- âœ… Task Configuration: ä»»åŠ¡é…ç½®ç»“æ„æ­£ç¡®
- âœ… Lambda Handler: å¤„ç†å™¨é€»è¾‘æ­£ç¡®
- âœ… Unknown Task Type: é”™è¯¯å¤„ç†æ­£å¸¸

## ğŸ“Š å½“å‰ä»»åŠ¡é…ç½®

```
ğŸ“‹ Scheduled Tasks Configuration

1. python-task-1 ğŸŸ¢ ENABLED
   Schedule: rate(5 minutes)
   Function: python_crawler (python3.11)

2. python-task-2 ğŸŸ¢ ENABLED
   Schedule: rate(10 minutes)
   Function: python_crawler (python3.11)

3. nodejs-task-1 ğŸŸ¢ ENABLED
   Schedule: rate(3 minutes)
   Function: nodejs_crawler (nodejs18.x)

4. nodejs-task-2 ğŸŸ¢ ENABLED
   Schedule: rate(7 minutes)
   Function: nodejs_crawler (nodejs18.x)

5. daily-summary ğŸ”´ DISABLED
   Schedule: cron(0 18 * * ? *)
   Function: python_crawler (python3.11)

Total: 5 tasks (4 enabled)
```

## ğŸš€ éƒ¨ç½²å‡†å¤‡

### ç¯å¢ƒçŠ¶æ€

- âœ… Python è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- âœ… ä¾èµ–å·²å®‰è£… (boto3)
- âœ… é…ç½®æ–‡ä»¶å·²éªŒè¯
- âœ… æœ¬åœ°æµ‹è¯•å·²é€šè¿‡

### éƒ¨ç½²å‘½ä»¤

```bash
# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
bun sst deploy --stage dev

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
bun sst list

# æŸ¥çœ‹æ—¥å¿—
bun sst logs --function python_crawlerFunction --follow
```

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 1: æ¡†æ¶éªŒè¯ (å½“å‰)

1. âœ… åˆ›å»ºå¯é…ç½®çš„å®šæ—¶ä»»åŠ¡æ¡†æ¶
2. âœ… å®ç°ç®€å•çš„ä»»åŠ¡éªŒè¯é€»è¾‘
3. âœ… åˆ›å»ºç®¡ç†å·¥å…·
4. ğŸ”„ éƒ¨ç½²åˆ° AWS éªŒè¯æ¡†æ¶å·¥ä½œ

### Phase 2: æ•°æ®çˆ¬å–å®ç° (ä¸‹ä¸€æ­¥)

1. **è‚¡ç¥¨æ•°æ®çˆ¬å–**: ä½¿ç”¨ akshare è·å– A è‚¡æ•°æ®
2. **åŸºé‡‘æ•°æ®çˆ¬å–**: è·å– ETF å’ŒåŸºé‡‘æ•°æ®
3. **åŠ å¯†è´§å¸æ•°æ®**: ä½¿ç”¨ CoinGecko API
4. **å¸‚åœºæŒ‡æ•°æ•°æ®**: è·å–ä¸»è¦æŒ‡æ•°ä¿¡æ¯

### Phase 3: æ•°æ®å­˜å‚¨ä¼˜åŒ–

1. **æ•°æ®æ¨¡å‹è®¾è®¡**: ä¼˜åŒ– DynamoDB è¡¨ç»“æ„
2. **æ•°æ®éªŒè¯**: æ·»åŠ æ•°æ®è´¨é‡æ£€æŸ¥
3. **é”™è¯¯å¤„ç†**: å®Œå–„å¼‚å¸¸å¤„ç†æœºåˆ¶
4. **ç›‘æ§å‘Šè­¦**: è®¾ç½® CloudWatch å‘Šè­¦

### Phase 4: æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡å¤„ç†**: ä¼˜åŒ–æ•°æ®æ‰¹é‡å†™å…¥
2. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ æ•°æ®ç¼“å­˜
3. **å¹¶å‘æ§åˆ¶**: ä¼˜åŒ–ä»»åŠ¡å¹¶å‘æ‰§è¡Œ
4. **æˆæœ¬ä¼˜åŒ–**: ç›‘æ§å’Œä¼˜åŒ– AWS æˆæœ¬

## ğŸ“ æ–‡ä»¶ç»“æ„

```
Kairos-BE/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ scheduled-tasks.json          # ä»»åŠ¡é…ç½®æ–‡ä»¶
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ python_crawler.py             # Python ä»»åŠ¡æ¡†æ¶
â”‚   â”œâ”€â”€ nodejs_crawler.js             # Node.js ä»»åŠ¡æ¡†æ¶
â”‚   â”œâ”€â”€ test_crawler.py               # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ pyproject.toml                # Python ä¾èµ–é…ç½®
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ task-manager.js               # ä»»åŠ¡ç®¡ç†å·¥å…·
â”œâ”€â”€ sst.config.ts                     # SST é…ç½®
â””â”€â”€ docs/
    â””â”€â”€ development/
        â”œâ”€â”€ framework-overview.md     # æœ¬æ–‡æ¡£
        â”œâ”€â”€ framework-deployment.md   # éƒ¨ç½²æŒ‡å—
        â””â”€â”€ data-crawler-architecture.md # æ•°æ®çˆ¬å–æ¶æ„
```

## ğŸ‰ æˆåŠŸæŒ‡æ ‡

æ¡†æ¶éªŒè¯æˆåŠŸçš„æ ‡å¿—ï¼š

1. âœ… **é…ç½®æ­£ç¡®**: ä»»åŠ¡é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡
2. âœ… **ä»£ç è´¨é‡**: æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. âœ… **æ¶æ„æ¸…æ™°**: æ–‡ä»¶ç»“æ„åˆç†ï¼Œæ˜“äºç»´æŠ¤
4. âœ… **å·¥å…·å®Œå–„**: ç®¡ç†å·¥å…·åŠŸèƒ½å®Œæ•´
5. ğŸ”„ **éƒ¨ç½²æˆåŠŸ**: AWS èµ„æºåˆ›å»ºæˆåŠŸ
6. ğŸ”„ **ä»»åŠ¡æ‰§è¡Œ**: å®šæ—¶ä»»åŠ¡æ­£å¸¸è¿è¡Œ
7. ğŸ”„ **æ•°æ®å­˜å‚¨**: DynamoDB è®°å½•ä»»åŠ¡ç»“æœ

## ğŸ’¡ è®¾è®¡äº®ç‚¹

1. **é…ç½®é©±åŠ¨**: é€šè¿‡ JSON é…ç½®æ–‡ä»¶ç®¡ç†ä»»åŠ¡ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
2. **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒ Python å’Œ Node.jsï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©
3. **ç®¡ç†å·¥å…·**: æä¾›å‘½ä»¤è¡Œå·¥å…·ç®¡ç†ä»»åŠ¡
4. **æµ‹è¯•è¦†ç›–**: å®Œæ•´çš„æµ‹è¯•å¥—ä»¶éªŒè¯åŠŸèƒ½
5. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„éƒ¨ç½²å’Œè¿ç»´æ–‡æ¡£

---

**çŠ¶æ€**: æ¡†æ¶å¼€å‘å®Œæˆï¼Œå‡†å¤‡éƒ¨ç½²éªŒè¯
**ä¸‹ä¸€æ­¥**: éƒ¨ç½²åˆ° AWS éªŒè¯æ¡†æ¶å·¥ä½œ
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

# Kairos-BE

Backend service for Kairos, synchronizing data using Akshare and AWS DynamoDB, deployed with SST.

## Prerequisites

Before you begin, ensure you have the following installed:

- **Python:** Version 3.11.x ([Download Python](https://www.python.org/downloads/))
- **Node.js:** Version 22.x (LTS) or higher ([Download Node.js](https://nodejs.org/) or use a version manager like [nvm](https://github.com/nvm-sh/nvm))
- **uv:** A fast Python package installer and resolver. ([Installation Guide](https://docs.astral.sh/uv/getting-started/installation/))
- **Bun:** A fast JavaScript runtime, bundler, test runner, and package manager. ([Installation Guide](https://bun.sh/docs/installation))

## Setup Instructions

1.  **Clone the repository:**

    ```bash
    git clone <your-repository-url>
    cd Kairos-BE
    ```

2.  **Set up Python Virtual Environment:**

    - Create the virtual environment using `uv` and Python 3.11:

    ```bash
    uv venv -p 3.11 .venv
    ```

    - Activate the virtual environment:

    ```bash
    # On macOS/Linux
    source .venv/bin/activate
    # On Windows (Git Bash)
    # source .venv/Scripts/activate
    # On Windows (Command Prompt)
    # .venv\Scripts\activate.bat
    # On Windows (PowerShell)
    # .venv\Scripts\Activate.ps1
    ```

    You should see `(.venv)` prepended to your shell prompt.

3.  **Set up Node.js Environment and Install Dependencies:**

    - This project uses `bun` to manage Node.js dependencies (like SST).
    - Install dependencies defined in `package.json`:

    ```bash
    bun install
    ```

    This will create a `bun.lockb` file locking the dependency versions.

4.  **Install Python Dependencies (Workspace Setup):**
    - This project uses `uv` workspaces (`functions` and `core`). Dependencies are defined in `functions/pyproject.toml` and `core/pyproject.toml`.
    - **(You need to create these `pyproject.toml` files first!)**
    - Once the workspace `pyproject.toml` files are defined, install all workspace dependencies (ensure the Python virtual environment `.venv` is active):
    ```bash
    # (Run from the project root directory)
    uv pip sync
    ```

## Project Structure

- `.venv/`: Python virtual environment (managed by `uv`, ignored by Git).
- `core/`: Shared Python code/logic workspace.
- `functions/`: Python Lambda function handlers workspace.
- `node_modules/`: Node.js dependencies (managed by `bun`, ignored by Git).
- `.gitignore`: Specifies intentionally untracked files that Git should ignore.
- `bun.lockb`: Exact dependency versions for Node.js packages (generated by `bun install`).
- `package.json`: Node.js project configuration and dependencies.
- `pyproject.toml`: Root Python project configuration (defines `uv` workspace).
- `sst.config.ts`: SST configuration file for defining AWS infrastructure (using TypeScript).
- `tsconfig.json`: TypeScript configuration for the `sst.config.ts` file.
- `README.md`: This file.

## Development

1.  **Activate Python environment:** `source .venv/bin/activate`
2.  **Start SST Live Development:**
    ```bash
    bun sst dev
    ```
    This command starts a local development environment that proxies requests to your Lambda functions running locally, enabling fast feedback loops. Ensure you have configured AWS credentials locally.

## Deployment

- Deploy your application to the configured AWS region (`us-east-1` by default in `sst.config.ts`):
  ```bash
  bun sst deploy
  ```
- To deploy to a specific stage (e.g., production):
  ```bash
  bun sst deploy --stage prod
  ```

## Next Steps

- Define the Python package structure and dependencies within `functions/pyproject.toml` and `core/pyproject.toml`. Include packages like `akshare`, `boto3`, etc., as needed.
- Implement the data synchronization logic within the Python Lambda functions located in `functions/src/`.
- Implement any shared Python logic in `core/src/`.
- Define your AWS resources (like the DynamoDB table and Lambda functions) in `sst.config.ts`.
